---
title: 'cleanup_outputs.sh Script'
description: 'Documentation for the cleanup_outputs.sh script for managing ComfyUI output files'
---

# cleanup_outputs.sh Script

The `cleanup_outputs.sh` script is a utility for automatically cleaning up old output files generated by ComfyUI instances. It helps manage disk space by removing files that are no longer needed.

## Overview

This script is designed to run periodically via cron to clean up output files that are older than a specified time threshold. It's installed in the container at `/usr/local/bin/cleanup_outputs.sh` and is configured to run every 15 minutes.

## Implementation

The script is a simple bash script that finds and removes files in the output directories of each GPU instance:

```bash
#!/bin/bash

ROOT="${ROOT:-/workspace}"
NUM_GPUS="${NUM_GPUS:-1}"

# Function to log messages
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*"
}

# Clean up outputs for all GPU instances
for gpu in $(seq 0 $((NUM_GPUS-1))); do
    OUTPUT_DIR="${ROOT}/comfyui_gpu${gpu}/output"
    
    if [ -d "$OUTPUT_DIR" ]; then
        log "Cleaning output directory for GPU $gpu: $OUTPUT_DIR"
        find "$OUTPUT_DIR" -type f -mmin +60 -delete
        find "$OUTPUT_DIR" -type d -empty -delete
    else
        log "Output directory for GPU $gpu does not exist: $OUTPUT_DIR"
    fi
done

log "Cleanup complete"
```

## Functionality

The script performs the following operations:

1. Iterates through each GPU instance (from 0 to NUM_GPUS-1)
2. For each GPU, it checks if the output directory exists
3. If the directory exists, it:
   - Deletes files that are older than 60 minutes (`-mmin +60`)
   - Removes empty directories that might be left after file deletion
4. Logs the operations for monitoring and troubleshooting

## Configuration

The script uses the following environment variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `ROOT` | Root directory for ComfyUI instances | `/workspace` |
| `NUM_GPUS` | Number of GPU instances | `1` |

## Cron Configuration

The script is configured to run every 15 minutes via a cron job. This configuration is set up in the Dockerfile:

```dockerfile
# Copy cleanup script and setup cron
COPY scripts/cleanup_outputs.sh /usr/local/bin/cleanup_outputs.sh
RUN chmod +x /usr/local/bin/cleanup_outputs.sh && \
    echo "*/15 * * * * /usr/local/bin/cleanup_outputs.sh >> /var/log/cleanup.log 2>&1" > /etc/cron.d/cleanup && \
    chmod 0644 /etc/cron.d/cleanup
```

## Log Files

The script logs its operations to:
- Standard output (which is redirected to `/var/log/cleanup.log` by the cron job)
- Each line is prefixed with a timestamp for tracking when operations occurred

## Customization

If you need to adjust the cleanup behavior, you can modify:

1. The time threshold (`-mmin +60`) to keep files for longer or shorter periods
2. The cron schedule (`*/15 * * * *`) to run more or less frequently
3. The directories to clean if you have additional output locations

## Related Components

- [docker-file.mdx](/gpu-containers/docker-file): Contains the cron job configuration for this script
- [start.sh](/gpu-containers/start-script): The main startup script that ensures cron is running
